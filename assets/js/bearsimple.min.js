console.log("\n %c Bearsimple v2.2.6 %c https://github.com/whitebearcode/typecho-bearsimple \n","border-radius:10px 0 0 10px;color: #fadfa3; background: #030307; padding:5px 0;","border-radius:0 10px 10px 0;background: #fadfa3; padding:5px 0;");function lazyLoad(){$.getScript(setting.import+"assets/js/lazyload.min.js",function(option){setting=$.extend(option);const lazyLoad=new LazyLoad({elements_selector:"img.lazy,img.lazyload"});});}function answerShow(){$('#answerhide').on('click',function(){$('.answer').fadeIn();$('#answershow').show();$('#answerhide').hide();});$('#answershow').on('click',function(){$('.answer').fadeOut();$('#answershow').hide();$('#answerhide').show();});}function fontChange(){if(!localStorage.getItem('article_font')){$('.article_change_m').addClass('article_default');localStorage.setItem('article_font','m');}$('.article_change_k').on('click',function(){$('.post-content').removeClass('article_font_xlwk');$('.article_change_m').removeClass('article_default');$('.article_change_xlwk').removeClass('article_default');$('.post-content').addClass('article_font');$('.article_change_k').addClass('article_default');localStorage.setItem('article_font','k');});$('.article_change_m').on('click',function(){$('.post-content').removeClass('article_font');$('.post-content').removeClass('article_font_xlwk');$('.article_change_k').removeClass('article_default');$('.article_change_xlwk').removeClass('article_default');$('.article_change_m').addClass('article_default');localStorage.setItem('article_font','m');});$('.article_change_xlwk').on('click',function(){$('.post-content').removeClass('article_font');$('.article_change_k').removeClass('article_default');$('.article_change_m').removeClass('article_default');$('.post-content').addClass('article_font_xlwk');$('.article_change_xlwk').addClass('article_default');localStorage.setItem('article_font','xlwk');});if(localStorage.getItem('article_font')){switch(localStorage.getItem('article_font')){case'k':$('.post-content').addClass('article_font');$('.article_change_xlwk').removeClass('article_default');$('.article_change_k').addClass('article_default');$('.article_change_m').removeClass('article_default');break;case'xlwk':$('.post-content').addClass('article_font_xlwk');$('.article_change_k').removeClass('article_default');$('.article_change_m').removeClass('article_default');$('.article_change_xlwk').addClass('article_default');break;case'm':$('.post-content').removeClass('article_font');$('.article_change_k').removeClass('article_default');$('.article_change_ylwk').removeClass('article_default');$('.article_change_m').addClass('article_default');break;}}}(function($){$.fn.extend({BsOptions:function(option){setting=$.extend(option);getThis=this.prop("className")!==""?"."+this.prop("className"):this.prop("id")!==""?"#"+this.prop("id"):this.prop("nodeName");document.addEventListener("scroll",function(e){var scrollTop=document.documentElement.scrollTop||document.body.scrollTop;var clientHeight=document.documentElement.clientHeight;var scrollHeight=document.documentElement.scrollHeight;if(setting.Top=='true'){if(scrollTop<300){$("#bs-scroll-to-top").fadeOut('1000');}else{$("#bs-scroll-to-top").fadeIn('1000');}}if(setting.readprocess=='true'){progressBar=document.querySelector('.read_progress');progressBar.style.width=+(scrollTop/(scrollHeight-clientHeight)).toFixed(2)*100+'%'}});fontChange();answerShow();$(document).on("click","#read",function(){$('html,body').animate({scrollTop:0},1000);});$(document).on("click",".editsays",function(){$('html,body').animate({scrollTop:0},1000);});$(function(){$(document).on("click","#bs-scroll-to-top",function(){$('html,body').animate({scrollTop:0},1000);return false});});if(setting.pjax=='2'||setting.pjax==null){clickToHref();function clickToHref(){var eles=document.querySelectorAll("div[hrefs]");eles.forEach(function(item){item.addEventListener("click",function(){var href=item.getAttribute("hrefs");var target=item.getAttribute("target");if(!target){location.href=href;}else{window.open(href,target);}});})}if(setting.search>0){clickToHref2();function clickToHref2(){var eles=document.querySelectorAll("i[hrefx]");eles.forEach(function(item){item.addEventListener("click",function(){var href=item.getAttribute("hrefx");var target=item.getAttribute("target");var header=setting.header_search;var phone=setting.phone_search;var sidebar=setting.sidebar_search;if(header=='true'){var header_value=document.getElementById("pcsearch").value;}else{var header_value='';}if(phone=='true'){var phone_value=document.getElementById("phonesearch").value;}else{var phone_value='';}if(sidebar=='true'){var sidebar_value=document.getElementById("sidebarsearch").value;}else{var sidebar_value='';}if(!target){location.href=href+header_value+phone_value+sidebar_value;}else{window.open(href,target);}});})}}}$.getScript('//cdn.staticfile.org/clipboard.js/2.0.8/clipboard.min.js',function(){let copy=new ClipboardJS('.bscopy');copy.on('success',function(e){$('body').toast({title:'复制成功',class:'green',message:'若要转载请务必保留原文链接！',showIcon:'grin beam outline',showProgress:'top',});});});if(Mathjax=='open'&&typeof MathJax!=='undefined'){MathJax.Hub.Config({showProcessingMessages:false,messageStyle:"none","HTML-CSS":{availableFonts:["STIX","TeX"],showMathMenu:false},tex2jax:{inlineMath:[['$','$'],['\\(','\\)']]}});MathJax.Hub.Queue(['Typeset',MathJax.Hub]);}class Countdown{constructor(el){this.el=el;this.targetDate=new Date(el.getAttribute("date-time"));this.createCountDownParts();this.countdownFunction();this.countdownLoopId=setInterval(this.countdownFunction.bind(this),1000);}createCountDownParts(){["days","hours","minutes","seconds"].forEach(part=>{const partEl=document.createElement("div");partEl.classList.add("part",part);const textEl=document.createElement("div");textEl.classList.add("text");if(part=='days'){textEl.innerText="天(Days)";}if(part=='hours'){textEl.innerText="小时(Hours)";}if(part=='minutes'){textEl.innerText="分钟(Mins)";}if(part=='seconds'){textEl.innerText="秒(S)";}const numberEl=document.createElement("div");numberEl.classList.add("number");numberEl.innerText=0;partEl.append(numberEl,textEl);this.el.append(partEl);this[part]=numberEl;});}countdownFunction(){const currentDate=new Date();if(currentDate>this.targetDate)return clearInterval(this.intervalId);const remaining=this.getRemaining(this.targetDate,currentDate);Object.entries(remaining).forEach(([part,value])=>{this[part].style.setProperty("--value",value);this[part].innerText=value;});}getRemaining(target,now){let seconds=Math.floor((target-now)/1000);let minutes=Math.floor(seconds/60);let hours=Math.floor(minutes/60);let days=Math.floor(hours/24);hours=hours-days*24;minutes=minutes-days*24*60-hours*60;seconds=seconds-days*24*60*60-hours*60*60-minutes*60;return{days,hours,minutes,seconds};}}const countdownEls=document.querySelectorAll(".progressdate-number")||[];countdownEls.forEach(countdownEl=>new Countdown(countdownEl));if(setting.ClockModule=='true'){let def_with=80;let exp=true;let root=document.documentElement;setInterval(()=>{let d=new Date();d.setMonth(0);d.setDate(1);d.setHours(0);d.setMinutes(0);d.setSeconds(0);let now=new Date();let elapsedY=now-d;let spy=secondsPerYear(now.getFullYear());let yperc=elapsedY/1000/spy;yperc=Math.round(yperc*10000000)/100000;yearprog.innerHTML=yperc+"%";yearbar.style.width=yperc+"%";let startOfMonth=new Date();startOfMonth.setDate(1);startOfMonth.setHours(0);startOfMonth.setMinutes(0);startOfMonth.setSeconds(0);startOfMonth.setMilliseconds(0);let elapsedM=now-startOfMonth;let spm=secondsPerMonth(now.getFullYear(),now.getMonth()+1);let mperc=elapsedM/1000/spm;mperc=Math.round(mperc*1000000)/10000;monthprog.innerHTML=mperc+"%";monthbar.style.width=mperc+"%";let startOfDay=new Date();startOfDay.setHours(0);startOfDay.setMinutes(0);startOfDay.setSeconds(0);startOfDay.setMilliseconds(0);let elapsedD=now-startOfDay;let dperc=elapsedD/1000/86400;dperc=Math.round(dperc*100000)/1000;dayprog.innerHTML=dperc+"%";daybar.style.width=dperc+"%";let startOfHour=new Date();startOfHour.setMinutes(0);startOfHour.setSeconds(0);startOfHour.setMilliseconds(0);let elapsedH=now-startOfHour;let hperc=elapsedH/1000/3600;hperc=Math.round(hperc*10000)/100;hourprog.innerHTML=hperc+"%";hourbar.style.width=hperc+"%";let startOfMinute=new Date();startOfMinute.setSeconds(0);startOfMinute.setMilliseconds(0);let elapsedMi=now-startOfMinute;let miperc=elapsedMi/1000/60;miperc=Math.round(miperc*1000)/10;minuteprog.innerHTML=miperc+"%";minutebar.style.width=miperc+"%";},1000);function secondsPerYear(year){if(leapYear(year)){return 31622400;}else{return 31536000;}}function leapYear(year){return year%4==0&&year%100!=0||year%400==0;}function secondsPerMonth(y,m){let spm=new Date(y,m,0).getDate()*24*3600;return spm;}}if($('.owl-carousel').length){$.getScript(setting.import+"assets/js/carousel.min.js",function(){$("#bs-morepost").owlCarousel({items:3,itemsDesktop:[1199,2],itemsDesktopSmall:[980,2],itemsMobile:[600,1],pagination:true,navigationText:false,autoPlay:true});});}$("#bs-theme-control").on("click",function(e){$(".bstheme-control-panel").css({"right":$(window).width()-$(this).offset().left+20,"bottom":-($(this).offset().top-$(document).scrollTop()-$(window).height()+$(this).height())}).toggle();e.stopPropagation();});$('.bstheme-control-panel').on("click",function(e){e.stopPropagation();});$("body").on('click',function(){$(".bstheme-control-panel").hide();});if(setting.darkmode=='true'){if(setting.darkmodetype!==''&&setting.darkmodetype.indexOf("2")!==-1){const media=window.matchMedia('(prefers-color-scheme:dark)');media.addEventListener('change',(e)=>{if(e.matches){$('#darkmode').attr("checked",true);document.documentElement.setAttribute('data-theme','dark');localStorage.setItem('theme','dark');}else{$('#darkmode').attr("checked",false);document.documentElement.setAttribute('data-theme','light');localStorage.setItem('theme','light');}});}if(setting.darkmodetype!==''&&setting.darkmodetype.indexOf("1")!=-1){const nowtime=new Date().getHours();if(localStorage.getItem('clickmode')!=='true'){if(nowtime>=22&&nowtime<=6||nowtime===22){$('#darkmode').attr("checked",true);document.documentElement.setAttribute('data-theme','dark');localStorage.setItem('theme','dark');localStorage.setItem('automode','true');}else{if(localStorage.getItem("automode")=='true'){localStorage.removeItem('automode');}}}}const currentTheme=localStorage.getItem('theme')?localStorage.getItem('theme'):null;$('#darkmode').on('click',function(){if(setting.Mournmode=='true'){$('body').toast({title:'抱歉',class:'warning',message:'当前处于哀悼模式，无法进入夜间模式哦~',showIcon:'flushed outline',showProgress:'top',});return false;}if(localStorage.getItem("automode")=='true'){localStorage.setItem('clickmode','true');}else{localStorage.removeItem('clickmode');}if($('#darkmode').is(':checked')){document.documentElement.setAttribute('data-theme','dark');localStorage.setItem('theme','dark');}else{document.documentElement.setAttribute('data-theme','light');localStorage.setItem('theme','light');}});if(currentTheme&&setting.Mournmode!=='true'){document.documentElement.setAttribute('data-theme',currentTheme);if(currentTheme==='light'){$('#darkmode').attr("checked",false);}else if(currentTheme==='dark'){$('#darkmode').attr("checked",true);}}}if($('#poster-btn').length){$.getScript(setting.import+"assets/vendors/bs-poster/bposter.js");}if(setting.infinite_scroll=='true'){$.getScript("//lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery-infinitescroll/4.0.1/infinite-scroll.pkgd.min.js",function(){if($('#bsnext').length){$('.content_container').infiniteScroll({path:'.next',append:article_element,hideNav:'.pagination',status:'.page-load-status',history:false,button:'#bsnext',scrollThreshold:false,});}});}if(setting.slider=='true'){$.getScript(setting.import+"assets/vendors/slider/bearslider.min.js",function(){$(".bearslider").fadeIn();$('.bearslider').bearSlider({mode:'fade',captions:true,auto:true,nextText:'前进',prevText:'后退',autoHover:true,adaptiveHeight:true});});}if(setting.menu_style=='2'){$(function(){var $mainMenuState=$('#main-menu-state');if($mainMenuState.length){$mainMenuState.change(function(e){var $menu=$('#main-menu');if(this.checked){$menu.hide().slideDown(450,function(){$menu.css('display','');});}else{$menu.show().slideUp(450,function(){$menu.css('display','');});}});}});$.getScript(setting.import+"assets/js/new-menu.min.js",function(){$('#main-menu').smartmenus({mainMenuSubOffsetX:-1,mainMenuSubOffsetY:4,subMenusSubOffsetX:6,subMenusSubOffsetY:-6});});}if(setting.Lazyload=='true'){lazyLoad();if(setting.infinite_scroll=='true'){$('.content_container').on('append.infiniteScroll',function(event,path,fetchPromise){lazyLoad();})}}if(setting.infinite_scroll=='true'&&(setting.pjax=='2'||setting.pjax==null)){$('.content_container').on('append.infiniteScroll',function(event,path,fetchPromise){clickToHref();})}if(setting.imagebox=='true'&&$('#bearsimple-images').length){$.getScript("//cdn.staticfile.org/viewerjs/1.11.3/viewer.min.js",function(){const gallery=new Viewer(document.getElementById('bearsimple-images'));if($('#bearsimple-images-readmode').length){const gallery2=new Viewer(document.getElementById('bearsimple-images-readmode'));}});}if(setting.Watermark=='true'){if(setting.WatermarkType=='1'||setting.WatermarkType==''){if(setting.waterMarkOutput!=='null'||setting.waterMarkOutput!==''){$.getScript(setting.import+"assets/js/bearmark.min.js",function(){$('.bearmark').watermark({textBg:setting.Watermark_textBg,textColor:setting.Watermark_textColor,text:setting.Watermark_text,textWidth:setting.Watermark_textWidth,textSize:setting.Watermark_textSize,gravity:setting.Watermark_gravity,opacity:setting.Watermark_opacity,margin:setting.Watermark_margin,outputType:setting.Watermark_outputType});});}else{$.getScript(setting.import+"assets/js/bearmark.min.js",function(){$('.bearmark').watermark({textBg:setting.Watermark_textBg,textColor:setting.Watermark_textColor,text:setting.Watermark_text,textWidth:setting.Watermark_textWidth,textSize:setting.Watermark_textSize,gravity:setting.Watermark_gravity,opacity:setting.Watermark_opacity,margin:setting.Watermark_margin,});});}}else{if(setting.waterMarkOutput!=='null'||setting.waterMarkOutput!==''){$.getScript(setting.import+"assets/js/bearmark.min.js",function(){$('.bearmark').watermark({path:setting.Watermark_path,gravity:setting.Watermark_gravity,opacity:setting.Watermark_opacity,margin:setting.Watermark_margin,outputType:setting.Watermark_outputType});});}else{$.getScript(setting.import+"assets/js/bearmark.min.js",function(){$('.bearmark').watermark({path:setting.Watermark_path,gravity:setting.Watermark_gravity,opacity:setting.Watermark_opacity,margin:setting.Watermark_margin,});});}}}if(setting.Popup=='true'){$.getScript(setting.import+"assets/vendors/bs-announcement/bs-announcement.min.js",function(option){setting=$.extend(option);$('#announcement').announcement({title:setting.PopupTitle,showToggle:setting.PopupTitleClose,showClose:setting.PopupClose,autoHide:setting.PopupAutoHide,autoClose:setting.PopupAutoClose,width:setting.PopupWidth,height:setting.PopupHeight,speed:setting.PopupSpeed,effect:setting.PopupEffect});});}if(setting.owo=='true'){$.getScript(setting.import+"assets/vendors/bs-emoji/bs-emoji.js?v=1.1",function(){$('#face').BearsimpleEmoji($('.emotion'));$('#facecross').BearsimpleEmoji($('.emotion'));$('#facesays').BearsimpleEmoji($('.emotion'));});}if(setting.scroll=='true'){$.getScript(setting.import+"assets/vendors/bs-toc/bs-toc.min.js",function(){window.tocManager.displayDisableTocTips=false;window.tocManager.generateToc();});}if(setting.sticky=='true'){$.getScript("//cdn.staticfile.org/stickybits/3.7.11/jquery.stickybits.min.js",function(){$('#sidebar').stickybits();});}$.getScript("//cdn.staticfile.org/fomantic-ui/2.9.2/semantic.min.js",function(){$('.slider.checkbox').checkbox({onChecked:function(){$('#textarea').addClass('bshideContent');},onUnchecked:function(){$('#textarea').removeClass('bshideContent');}});$('.toggle.checkbox').checkbox();$('.ui.star.rating').rating();$('.ui.heart.rating').rating();$('.ui.accordion').accordion();$('.message .close').on('click',function(){$(this).closest('.message').transition('fade');});$('.ui.embed').embed();$('.ui.dropdown').dropdown({on:'hover',});$("body").on("click",".fluid.card .image",function(){$('.ui.star.rating').rating();$('.fluid.card .image').dimmer({on:'hover'});});if($(".ui.secondary.menu").length>0||$(".ui.secondary.pointing.menu").length>0){$('.menu .item').tab();}$('.special.card .image').dimmer({on:'hover'});});if(setting.pjax=="1"){$.getScript("//cdn.staticfile.org/fomantic-ui/2.9.2/semantic.min.js",function(){$('.ui.search').search({apiSettings:{url:'/index.php/jsonapi/getarticle?keyword={query}',},fields:{results:'items',title:'article',url:'url',description:'description'},error:{serverError:'服务器错误，请重试',},minCharacters:1,maxResults:9999999999999999,showNoResults:false,onSelect(result,response){return false;}});});}else if(setting.pjax=="2"){$.getScript("//cdn.staticfile.org/fomantic-ui/2.9.2/semantic.min.js",function(){$('.ui.search').search({apiSettings:{url:'/index.php/jsonapi/getarticle?keyword={query}',},fields:{results:'items',title:'article',url:'url',description:'description'},error:{serverError:'服务器错误，请重试',},minCharacters:1,maxResults:9999999999999999,showNoResults:false,});});}$('#commentsubmit').on('click',function(){if(!$('#mail').val()&&setting.commentsRequireMail=='1'&&setting.islogin==''){$('body').toast({title:'评论失败',class:'warning',message:'检测到邮箱为空，请重新输入~',showIcon:'flushed outline',showProgress:'top',});return false;}if(!$('#url').val()&&setting.commentsRequireURL=='1'&&setting.islogin==''){$('body').toast({title:'评论失败',class:'warning',message:'检测到网址为空，请重新输入~',showIcon:'flushed outline',showProgress:'top',});return false;}if(!$('#textarea').val()){$('body').toast({title:'评论失败',class:'warning',message:'检测到评论内容为空，请重新输入~',showIcon:'flushed outline',showProgress:'top',});return false;}$(this).addClass('loading');setTimeout(function(){$.ajax({type:"POST",dataType:"html",url:$("#commentform").attr('action'),data:$("#commentform").serialize(),async:true,error:function(request){$('body').toast({title:'评论失败',class:'error',message:'请手动刷新页面后再尝试操作~',showIcon:'flushed outline',showProgress:'top',});if(setting.verify_type=='22'){$('#bsverify').show();document.getElementById("commentsubmit").setAttribute("disabled",true);}if(setting.verify_type=='2'&&setting.vid!==''){$('#VAPTCHAContainers').load(location.href+" #VAPTCHAContainers",function(){$.getScript('//v-cn.vaptcha.com/v3.js',function(option){setting=$.extend(option);vaptcha({vid:setting.vid,mode:'click',scene:1,container:'#VAPTCHAContainers',area:'auto',}).then(function(VAPTCHAObj){obj=VAPTCHAObj;VAPTCHAObj.render();VAPTCHAObj.renderTokenInput('#commentform');VAPTCHAObj.listen('pass',function(){document.getElementById("commentsubmit").removeAttribute("disabled");})})});});document.getElementById("commentsubmit").setAttribute("disabled",true);};if(setting.verify_type=='2-1'&&setting.dx_appid!==''&&setting.dx_apiserver!==''){$('#dx_captcha').load(location.href+" #dx_captcha",function(){$.getScript('https://cdn.dingxiang-inc.com/ctu-group/captcha-ui/index.js',function(option){setting=$.extend(option);var myCaptcha=_dx.Captcha(document.getElementById('dx_captcha'),{appId:setting.dx_appid,apiServer:'https://'+setting.dx_apiserver,success:function(token){let tokeninput=$("<input type='text' name='dx_token' style='display:none'/>");tokeninput.attr("value",token);$("#textarea").append(tokeninput);document.getElementById("commentsubmit").removeAttribute("disabled");}})})});document.getElementById("commentsubmit").setAttribute("disabled",true);};if(setting.verify_type=='2-2'&&setting.turnstile_sitekey!==''){$('#turnstile_captcha').load(location.href+" #turnstile_captcha",function(){$.getScript('https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback',function(){window.onloadTurnstileCallback=function(){$('#turnstile_captcha').html('');eval(function(p,a,c,k,e,r){e=String;if('0'.replace(0,e)==0){while(c--)r[e(c)]=k[c];k=[function(e){return r[e]||e}];e=function(){return'[1-4]'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\\\b'+e(c)+'\\\\b','g'),k[c]);return p});turnstile.render('#turnstile_captcha',{sitekey:setting.turnstile_sitekey,theme:setting.turnstile_theme,action:'comment',callback:function(token){document.getElementById("commentsubmit").removeAttribute("disabled");},})};});});document.getElementById("commentsubmit").setAttribute("disabled",true);};$('#commentsubmit').removeClass('loading');},success:function(data){if($(data).find("div[id=comments]").length>0){$('body').toast({title:'评论成功',class:'success',message:'您已评论成功，将自动刷新~',showIcon:'grin beam outline',showProgress:'top',});$('#bscommen').load(location.href+" #bscommen",function(option){setting=$.extend(option);if(setting.Lazyload=='true'){lazyLoad();}});$('#forminput').load(location.href+" #forminput",function(option){setting=$.extend(option);answerShow();typeof getCommentInfo!='undefined'&&getCommentInfo();if(setting.owo=='true'){$.getScript(setting.import+"assets/vendors/bs-emoji/bs-emoji.js?v=1.1",function(){$('#face').BearsimpleEmoji($('.emotion'));$('#facecross').BearsimpleEmoji($('.emotion'));});}$.getScript("//cdn.staticfile.org/fomantic-ui/2.9.2/components/checkbox.min.js",function(){$('.slider.checkbox').checkbox({onChecked:function(){$('#textarea').addClass('bshideContent');},onUnchecked:function(){$('#textarea').removeClass('bshideContent');}});});});if(setting.verify_type=='22'){$('#bsverify').show();document.getElementById("commentsubmit").setAttribute("disabled",true);}if(setting.verify_type=='2'&&setting.vid!==''){$('#VAPTCHAContainers').load(location.href+" #VAPTCHAContainers",function(){$.getScript('//v-cn.vaptcha.com/v3.js',function(option){setting=$.extend(option);vaptcha({vid:setting.vid,mode:'click',scene:1,container:'#VAPTCHAContainers',area:'auto',}).then(function(VAPTCHAObj){obj=VAPTCHAObj;VAPTCHAObj.render();VAPTCHAObj.renderTokenInput('#commentform');VAPTCHAObj.listen('pass',function(){document.getElementById("commentsubmit").removeAttribute("disabled");})})});});document.getElementById("commentsubmit").setAttribute("disabled",true);};if(setting.verify_type=='2-1'&&setting.dx_appid!==''&&setting.dx_apiserver!==''){$('#dx_captcha').load(location.href+" #dx_captcha",function(){$.getScript('https://cdn.dingxiang-inc.com/ctu-group/captcha-ui/index.js',function(option){setting=$.extend(option);var myCaptcha=_dx.Captcha(document.getElementById('dx_captcha'),{appId:setting.dx_appid,apiServer:'https://'+setting.dx_apiserver,success:function(token){let tokeninput=$("<input type='text' name='dx_token' style='display:none'/>");tokeninput.attr("value",token);$("#textarea").append(tokeninput);document.getElementById("commentsubmit").removeAttribute("disabled");}});});});document.getElementById("commentsubmit").setAttribute("disabled",true);};if(setting.verify_type=='2-2'&&setting.turnstile_sitekey!==''){$('#turnstile_captcha').load(location.href+" #turnstile_captcha",function(){$.getScript('https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback',function(){window.onloadTurnstileCallback=function(){turnstile.render('#turnstile_captcha',{sitekey:setting.turnstile_sitekey,callback:function(token){document.getElementById("commentsubmit").removeAttribute("disabled");},});};});});document.getElementById("commentsubmit").setAttribute("disabled",true);};$('#commentsubmit').removeClass('loading');}else{var div=$('<div>');div.html(data);var content=div.find('.container');$('body').toast({title:'啊哦~评论失败',class:'error',message:content.text(),showIcon:'flushed outline',showProgress:'top',});if(setting.verify_type=='22'){$('#bsverify').show();document.getElementById("commentsubmit").setAttribute("disabled",true);}if(setting.verify_type=='2'&&setting.vid!==''){$('#VAPTCHAContainers').load(location.href+" #VAPTCHAContainers",function(){$.getScript('//v-cn.vaptcha.com/v3.js',function(option){vaptcha({vid:setting.vid,mode:'click',scene:1,container:'#VAPTCHAContainers',area:'auto',}).then(function(VAPTCHAObj){obj=VAPTCHAObj;VAPTCHAObj.render();VAPTCHAObj.renderTokenInput('#commentform');VAPTCHAObj.listen('pass',function(){document.getElementById("commentsubmit").removeAttribute("disabled");})})});});document.getElementById("commentsubmit").setAttribute("disabled",true);};if(setting.verify_type=='2-1'&&setting.dx_appid!==''&&setting.dx_apiserver!==''){$('#dx_captcha').load(location.href+" #dx_captcha",function(){$.getScript('https://cdn.dingxiang-inc.com/ctu-group/captcha-ui/index.js',function(option){setting=$.extend(option);var myCaptcha=_dx.Captcha(document.getElementById('dx_captcha'),{appId:setting.dx_appid,apiServer:'https://'+setting.dx_apiserver,success:function(token){let tokeninput=$("<input type='text' name='dx_token' style='display:none'/>");tokeninput.attr("value",token);$("#textarea").append(tokeninput);document.getElementById("commentsubmit").removeAttribute("disabled");}});myCaptcha.reload();})});document.getElementById("commentsubmit").setAttribute("disabled",true);};if(setting.verify_type=='2-2'&&setting.turnstile_sitekey!==''){$('#turnstile_captcha').load(location.href+" #turnstile_captcha",function(){$.getScript('https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstileCallback',function(){window.onloadTurnstileCallback=function(){turnstile.render('#turnstile_captcha',{sitekey:setting.turnstile_sitekey,callback:function(token){document.getElementById("commentsubmit").removeAttribute("disabled");},});};});});document.getElementById("commentsubmit").setAttribute("disabled",true);};$('#commentsubmit').removeClass('loading');}}});},1000)});$('#protectajax').on('click',function(){$.ajax({type:"POST",url:$("#form").attr('action'),data:$("#form").serialize(),async:false,error:function(request){$('body').toast({title:'验证失败',class:'error',message:'您输入的文章密码有误，请重新输入~',showIcon:'flushed outline',showProgress:'top',});},success:function(data){$('body').toast({title:'验证成功',class:'success',message:'您已成功验证文章密码，页面将在3秒后刷新~',showIcon:'grin beam outline',showProgress:'top',});setTimeout(function(){window.location.reload();},3000);}});});if(setting.Login_hidden=='true'){$.getScript("//lf26-cdn-tos.bytecdntp.com/cdn/expire-0-ms/limonte-sweetalert2/11.4.4/sweetalert2.min.js",function(option){setting=$.extend(option);let login_qq='';let login_wechat='';let login_weibo='';let login_github='';let regiter_allow='';if(setting.login_other.indexOf("qq")!==-1){login_qq+='<a class="ui icon circular large label" href="/tepass/qq_login" pjax="no"><i class="qq icon"></i></a>';}if(setting.login_other.indexOf("weibo")!==-1){login_weibo+='<a class="ui icon circular large label" href="/tepass/wb_login" pjax="no"><i class="weibo icon"></i></a>';}if(setting.login_other.indexOf("wechat")!==-1){login_wechat+='<a class="ui icon circular large label" href="/tepass/wx_login" pjax="no"><i class="wechat icon"></i></a>';}if(setting.login_other.indexOf("github")!==-1){login_github+='<a class="ui icon circular large label" href="/tepass/gh_login" pjax="no"><i class="github icon"></i></a>';}if(setting.registerAllow=='1'&&setting.registerOpen=='1'){regiter_allow+=' or <span id="bs-reg">注册</span>';}$("#bs-login").on('click',function(){(async()=>{const login=await Swal.fire({title:'登录'+regiter_allow,html:'<div style="overflow: hidden;margin-left:-15px"><input id="swal-input1" class="swal2-input" placeholder="输入您的账号"><br>'+'<input id="swal-input2" type="password" class="swal2-input" placeholder="输入您的密码"></div><br>'+login_qq+login_weibo+login_wechat+login_github,focusConfirm:false,confirmButtonText:'立即登陆',showLoaderOnConfirm:true,showCancelButton:true,cancelButtonText:'关闭',preConfirm:()=>{if(!$('#swal-input1').val()){return Swal.showValidationMessage(`您的账号为空，请重新填写~`)}if(!$('#swal-input2').val()){return Swal.showValidationMessage(`您的密码为空，请重新填写~`)}return fetch('')},allowOutsideClick:()=>Swal.isLoading()}).then((result)=>{if(result.isConfirmed){$.ajax({type:"POST",url:setting.loginAction,data:{name:$('#swal-input1').val(),password:$('#swal-input2').val(),referer:window.location.href},async:false,error:function(request){$('body').toast({title:'登陆失败',class:'error',message:'请手动刷新页面后再尝试操作~',showIcon:'flushed outline',showProgress:'top',});},success:function(data){$.post(window.location.href,{action:'checklogin'},function(res){switch(res.code){case 0:$('body').toast({title:'登陆失败',class:'error',message:'您输入的账号密码有误，请重新输入~',showIcon:'flushed outline',showProgress:'top',});break;case 1:$('body').toast({title:'登陆成功',class:'success',message:'您已成功登陆，页面将在3秒后刷新~',showIcon:'grin beam outline',showProgress:'top',});setTimeout(function(){window.location.reload();},3000);break;default:$('body').toast({title:'登陆成功',class:'success',message:'您已成功登陆，页面将在3秒后刷新~',showIcon:'grin beam outline',showProgress:'top',});setTimeout(function(){window.location.reload();},3000);break;}})}});}});})();$("#bs-reg").on('click',function(){(async()=>{const register=await Swal.fire({title:'注册',html:'<div style="overflow: hidden;margin-left:-15px"><input id="swal-inputreg1" class="swal2-input" placeholder="输入您的账号"><br>'+'<input id="swal-inputreg2" type="mail" class="swal2-input" placeholder="输入您的邮箱"><br>'+'<input id="swal-inputreg3" type="password" class="swal2-input" placeholder="输入您的密码"><br>'+'<input id="swal-inputreg4" type="password" class="swal2-input" placeholder="再次输入您的密码"></div>',focusConfirm:false,confirmButtonText:'立即注册',showLoaderOnConfirm:true,showCancelButton:true,cancelButtonText:'关闭',preConfirm:()=>{if(!$('#swal-inputreg1').val()||/[^a-zA-Z0-9]/.test($('#swal-inputreg1').val())==true){return Swal.showValidationMessage(`您填写的账号不符合规则，仅允许大小写英文字母或数字，请重新填写~`)}if($('#swal-inputreg2').val().search(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)==-1){return Swal.showValidationMessage(`您的邮箱地址填写有误，请重新填写~`)}if($('#swal-inputreg3').val()!==$('#swal-inputreg4').val()){return Swal.showValidationMessage(`您两次输入的密码不一致，请重新输入~`)}if($('#swal-inputreg3').val().length<8){return Swal.showValidationMessage(`您的密码太短，密码请设置8位及以上，请重新输入~`)}return fetch('')},allowOutsideClick:()=>Swal.isLoading()}).then((result)=>{if(result.isConfirmed){$.ajax({type:"POST",url:setting.registerAction,data:{name:$('#swal-inputreg1').val(),password:$('#swal-inputreg3').val(),confirm:$('#swal-inputreg4').val(),mail:$('#swal-inputreg2').val(),regtype:'nobackend'},async:false,error:function(request){$('body').toast({title:'注册失败',class:'error',message:'请手动刷新页面后再尝试操作~',showIcon:'flushed outline',showProgress:'top',});},success:function(data){$.post(window.location.href,{action:'checklogin'},function(res){switch(res.code){case 0:$('body').toast({title:'注册失败',class:'error',message:'您输入的账号密码不合法或注册来源错误，请重新输入~',showIcon:'flushed outline',showProgress:'top',});break;case 1:$('body').toast({title:'注册成功',class:'success',message:'您已成功注册，页面将在3秒后刷新~',showIcon:'grin beam outline',showProgress:'top',});setTimeout(function(){window.location.reload();},3000);break;default:$('body').toast({title:'注册成功',class:'success',message:'您已成功注册，页面将在3秒后刷新~',showIcon:'grin beam outline',showProgress:'top',});setTimeout(function(){window.location.reload();},3000);break;}})}});}});})()});});});$(document).keypress(function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'&&$('#swal-input2').val()){$('.swal2-confirm').click();}if(keycode=='13'&&$('#swal-inputreg4').val()){$('.swal2-confirm').click();}});}if(setting.RewardOpenAlipay=='true'){$.getScript("//lf26-cdn-tos.bytecdntp.com/cdn/expire-0-ms/limonte-sweetalert2/11.4.4/sweetalert2.min.js",function(option){setting=$.extend(option);$("#bs-alipay").click(function(){Swal.fire({title:'支付宝打赏',text:'您可以通过扫描该二维码打赏作者',imageUrl:setting.RewardOpenAlipayQrcode,imageWidth:300,imageHeight:300,imageAlt:'支付宝打赏二维码',confirmButtonText:'关闭'})});});}if(setting.Sharewechat=='true'){$.getScript("//lf26-cdn-tos.bytecdntp.com/cdn/expire-0-ms/limonte-sweetalert2/11.4.4/sweetalert2.min.js",function(option){setting=$.extend(option);$("#wechatshare").click(function(){Swal.fire({title:'微信分享',text:'您可以将该二维码分享给朋友或者朋友圈',imageUrl:'https://api.qrserver.com/v1/create-qr-code/?data='+window.location.href,imageWidth:300,imageHeight:300,imageAlt:'微信分享二维码',confirmButtonText:'关闭'})});});}if(setting.RewardOpenWechat=='true'){$.getScript("//lf26-cdn-tos.bytecdntp.com/cdn/expire-0-ms/limonte-sweetalert2/11.4.4/sweetalert2.min.js",function(option){setting=$.extend(option);$("#bs-wechat").click(function(){Swal.fire({title:'微信打赏',text:'您可以通过扫描该二维码打赏作者',imageUrl:setting.RewardOpenWechatQrcode,imageWidth:300,imageHeight:300,imageAlt:'微信打赏二维码',confirmButtonText:'关闭'})});});}if(setting.Wechat_qrcode_status=='true'){$.getScript("//lf26-cdn-tos.bytecdntp.com/cdn/expire-0-ms/limonte-sweetalert2/11.4.4/sweetalert2.min.js",function(option){setting=$.extend(option);$("#contactwechat").click(function(){Swal.fire({title:'联系微信',text:'您可以通过扫描该二维码添加我的微信进行联系',imageUrl:setting.Wechat_qrcode,imageWidth:300,imageHeight:300,imageAlt:'我的微信二维码',confirmButtonText:'关闭'})});});}$(document).off('click','.slickcomment').on('click','.slickcomment',function(){let slickid=this.id;$(".ui.segment.comment-children."+slickid).toggle('fast',function(){if($(this).css('display')=='none'){$('#'+slickid).text("展开子评论");}else{$('#'+slickid).text("收起子评论");}　});});if(setting.QQ_qrcode_status=='true'){$.getScript("//lf26-cdn-tos.bytecdntp.com/cdn/expire-0-ms/limonte-sweetalert2/11.4.4/sweetalert2.min.js",function(option){setting=$.extend(option);$("#contactqq").click(function(){Swal.fire({title:'联系QQ',text:'您可以通过扫描该二维码添加我的QQ进行联系',imageUrl:setting.QQ_qrcode,imageWidth:300,imageHeight:300,imageAlt:'我的QQ二维码',confirmButtonText:'关闭'})});});}if(setting.Share=='true'){var title=$(document.head).find("[name=title], [name=Title]").attr("content")||document.title;var url=window.location.href;var domain=window.location.origin;var imgurl=$("img:first").prop("data-src")||$("img:first").prop("src");var description=$(document.head).find("[name=description], [name=Description]").attr("content")||"";var source=$(document.head).find("[name=site], [name=Site]").attr("content")||document.title;$('#qqshare').on('click',function(){window.open('http://connect.qq.com/widget/shareqq/index.html?url='+url+'&title='+title+'&source='+source+'&desc='+description+'&pics='+imgurl);});$('#qzoneshare').on('click',function(){window.open('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+url+'&title='+title+'&site='+source+'&desc='+description+'&summary='+description+'&pics='+imgurl);});if(setting.Sharewechat=='true'){$.getScript("//cdn.staticfile.org/jquery.qrcode/1.0/jquery.qrcode.min.js",function(){jQuery('#qrcode').qrcode({text:url});});}$('#weiboshare').on('click',function(){window.open('http://service.weibo.com/share/share.php?url='+url+'&title='+title+'&pic='+imgurl+'&appkey=');});$('#facebookshare').on('click',function(){window.open('https://www.facebook.com/sharer/sharer.php?u='+url+'&title='+title+'&source='+source+'&desc='+description+'&link='+url+'&captain=&picture='+imgurl);});$('#twittershare').on('click',function(){window.open('https://twitter.com/intent/tweet?text='+title+'&url='+url+'&via='+domain);});$('#googleshare').on('click',function(){window.open('https://plus.google.com/share?url='+url);});$('#linkedinshare').on('click',function(){window.open('http://www.linkedin.com/shareArticle?mini=true&ro=true&title='+title+'&url='+title+'&summary='+description+'&source='+source+'&armin=armin');});}if(setting.Translate=='1'){if(setting.TranslateLanguage=='1'){var TranslateLanguage=2;}else{var TranslateLanguage=1;};$.getScript(setting.import2+"modules/tw_cn.js",function(option){setting=$.extend(option);var defaultEncoding=TranslateLanguage;var translateDelay=0;var cookieDomain=setting.siteUrl;var msgToTraditionalChinese="切换为繁體";var msgToSimplifiedChinese="切换为简体";var translateButtonId="translateLink";translateInitilization();});}localStorage.setItem("fontsize","default");$('#fontsizes').click(function(){switch(localStorage.getItem("fontsize")){case'default':localStorage.setItem("fontsize","18");$("#post-content").animate({"font-size":"18px"});break;case'18':localStorage.setItem("fontsize","25");$("#post-content").animate({"font-size":"25px"});break;case'25':localStorage.setItem("fontsize","32");$("#post-content").animate({"font-size":"32px"});break;default:localStorage.setItem("fontsize","default");$("#post-content").animate({"font-size":"15px"});}});$('.ui.form').on('click','#randname',function(){const b=["大名鼎鼎","躲闪","骄傲","挺胸","不知名","知名","刚下飞机","看透一切","小有名气","潜心学习","生龙活虎","生气勃勃","说话诙谐","说话风趣","妙趣横生","妙语连珠","挤眉弄眼","天真活泼","天真烂漫","天真无邪","稚气未脱","聪明伶俐","机智灵巧","心灵手巧","能说会道","无忧无虑","无拘无束","开朗大方","幽默风趣","逗人发笑","憨直可爱","性格爽直","性格豪爽","直截了当","直言相告","直言不讳","有口无心","快嘴快舌","直抒已见","令人捧腹","饶有风趣","趣味盎然","心直口快","快人快语"],c=["大黄","匿名人士","男士","女士","人士","男孩","女孩","贫僧","道士","学生","打工人","少侠","白领","蓝领","小学生","初中生","高中生","大学生","研究生","博士生","教授"];var randname=b[Math.floor(Math.random()*b.length)]+"的"+c[Math.floor(Math.random()*c.length)];document.getElementById('author').value=randname;});if(setting.Like=='true'){$('#agree-btn').on('click',function(){if(localStorage.getItem("cid"+$('#agree-btn').attr('data-cid'))=='like=true'){$('body').toast({title:'点赞失败',class:'warning',message:'啊哦，您已经点赞过惹~',showIcon:'flushed outline',showProgress:'top',});}else{$.ajax({type:'post',url:setting.getPostLikeFile,data:'agree='+$('#agree-btn').attr('data-cid'),async:true,timeout:30000,cache:false,success:function(data){json=JSON.parse(data);if(json.code==2){$('body').toast({title:'点赞失败',class:'warning',message:'检测到来源错误，请稍后再试~',showIcon:'flushed outline',showProgress:'top',});}else{$('.agreenum').html(json.agree);localStorage.setItem("cid"+$('#agree-btn').attr('data-cid'),'like=true');$('body').toast({title:'点赞成功',class:'green',message:'Yeah~您已成功点赞本文章!',showIcon:'grin beam outline',showProgress:'top',});}},error:function(){$('body').toast({title:'点赞失败',class:'warning',message:'网络出现堵塞，请稍后重试~',showIcon:'dizzy outline',showProgress:'top',});},});}});}if(setting.CommentLike=='true'){$(document).off('click').on('click','.like.thumbs.up.red.link.icon',function(){if(localStorage.getItem("coid"+$(this).attr('data-coid'))=='like=true'){$('body').toast({title:'点赞失败',class:'warning',message:'啊哦，您已经点赞过惹~',showIcon:'flushed outline',showProgress:'top',});}else{$.ajax({type:'post',url:setting.getCommentLikeFile,data:{agree:$(this).attr('data-coid'),},async:true,timeout:30000,cache:false,success:function(data){json=JSON.parse(data);if(json.code==2){$('body').toast({title:'点赞失败',class:'warning',message:'检测到来源错误，请稍后再试~',showIcon:'flushed outline',showProgress:'top',});}else{$('.agreenumcomment'+json.coid).html(json.agree);localStorage.setItem("coid"+json.coid,'like=true');$('body').toast({title:'点赞成功',class:'green',message:'Yeah~您已成功点赞!',showIcon:'grin beam outline',showProgress:'top',});}},error:function(){$('body').toast({title:'点赞失败',class:'warning',message:'网络出现堵塞，请稍后重试~',showIcon:'dizzy outline',showProgress:'top',});},});}});}return this}})}(jQuery));